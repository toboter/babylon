<% title "#{@list.project ? @list.project.name : 'List'}", @list.name %>
<% edit_section_for(@list, @list.project) if @list.project.memberships.where(:user_id => current_user, :role => 'admin').present? || (can? :manage, 'Memberships') %>
<% footer_section(@list.project) %>

<% content_for :breadcrumbs_section do %>
  <%= content_tag(:li, link_to("Root", root_path) + content_tag(:span, '/', class: 'divider')) %>
  <%= content_tag(:li, link_to("Modules", clusters_path) + content_tag(:span, '/', class: 'divider')) %>
  <% if @list.project && @list.project.projectable.class.to_s == 'Group' %>
    <%= content_tag(:li, link_to("#{@list.project.projectable.cluster.name}", cluster_path(@list.project.projectable.cluster)) + content_tag(:span, '/', class: 'divider')) %>
    <%= content_tag(:li, link_to("Groups", cluster_groups_path(@list.project.projectable.cluster)) + content_tag(:span, '/', class: 'divider')) %>
  <% end %>

  <%= content_tag(:li, (link_to "#{@list.project.projectable.name}", (@list.project.projectable.class.to_s == 'Group' ? [@list.project.projectable.cluster, @list.project.projectable] : @list.project.projectable )) + content_tag(:span, '/', class: 'divider')) if @list.project %>

  <%= content_tag(:li, (link_to "Projects", [@list.project.projectable, :projects]) + content_tag(:span, '/', class: 'divider')) if @list.project %>
  <%= content_tag(:li, (link_to "#{@project.name}", [@list.project.projectable, @project]) + content_tag(:span, '/', class: 'divider')) if @list.project %>
  <%= content_tag(:li, (link_to "Lists", [@list.project, :lists]) + content_tag(:span, '/', class: 'divider')) if @list.project %>
  <%= content_tag :li, @list.name, class: 'active' %>
<% end %>

<% content_for :head do %>
  <script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
  <script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
<% end %>

<% content_for :scripts do %>
  <script type="text/javascript">
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {mapTypeId: google.maps.MapTypeId.SATELLITE}, internal: {id: 'map'}}, function(){
      markers = handler.addMarkers(<%=raw @hash.to_json %>);
      handler.bounds.extendWith(markers);
      handler.fitMapToBounds();
    });
  </script>
<% end %>

<% content_for :main_section do %>
<div class="row-fluid">
  <div class="span5">


<p>
  <b>Name:</b>
  <%= @list.name %>
</p>

<p>
  <b>Forkable:</b>
  <%= @list.forkable %>
</p>

<p>
  <b>Duplicates:</b>
  <%= @list.accept_duplicates %>
</p>

<p>
  <b>Forked from:</b>
  <%= @list.forked_from_id %>
</p>

<p>
  <b>Featured:</b>
  <%= @list.featured %>
</p>

<p>
  <b>Description:</b>
  <%= @list.description %>
</p>

<p>
  <b>Location:</b>
  <%= @list.locations.inspect %>
</p>

<p>
  <b>Project:</b>
  <%= full_qualified_name(@list.project) %><br />
  <%= name_only_or_link_to(@list.creator) %>
</p>
</div>
<div class="span7">
            <%= content_tag :div, style: 'width: 100%; margin-bottom:30px;' do %>
            <div id="map" style='width: 100%; height: 500px;'></div>
            <p>Studied objects are only shown on the map if a location is provided.</p>
          <% end if @hash.any? %>
        </div>
      </div>

        <div class="row-fluid">
          <div class="span12">
  <%= content_tag :div, class: 'tiles', id: 'study-tiles' do %>
    <%= content_tag :h3, 'Studied objects' %>
    <%= render "studies/study_tiles", studies: @list.studies.limit(8)  %>
    <%= link_to "View all studies in #{@list.name}", [@list, :studies] %>
  <% end if @list.studies.any? %>
</div>
</div>
<% end %>