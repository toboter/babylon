<% title "Research Group", @group.name %>
<% edit_section_for(@group, nil) if @group.group_admin == current_user || @group.creator == current_user || current_user.superuser? %>

<% content_for :add_section do %>
  <li><%= link_to 'Project', new_group_project_path(@group) %></li>
  <li class="divider"></li>
  <li><%= link_to 'Document', polymorphic_path([:new, @group, :document]) %></li>
<% end if can? :edit, @group %>

<% content_for :breadcrumbs_section do %>
  <%= content_tag(:li, link_to("Root", root_path) + content_tag(:span, '/', class: 'divider')) %>
  <%= content_tag(:li, link_to("#{@group.cluster.name}", @group.cluster) + content_tag(:span, '/', class: 'divider')) %>
  <%= content_tag(:li, link_to("Groups", cluster_groups_path(@group.cluster)) + content_tag(:span, '/', class: 'divider')) %>
  <%= content_tag :li, "#{@group.name}", class: 'active' %>
<% end %>

<% content_for :main_section do %>
  <%= content_tag :div, class: 'lead', id: 'about', style: 'margin-bottom:30px;' do %>
    <%= markdown(@group.description) %>
  <% end if @group.description %>

  <%= content_tag :h4, link_to('Projects', group_projects_path(@group)), class: "muted" if @group.projects.present? %>
  <% @group.projects.each do |project| %>
    <div class="well">
      <h4>
        <%= link_to [project.projectable, project] do %>
          <%= project.projectable.name if project.projectable_type == "Cluster" %>
          <% if project.projectable_type == "Group" %>
            <%= project.projectable.cluster.name %> /
            <%= project.projectable.name %>
          <% end %>
          /
          <%= project.name %>
        <% end %>
      </h4>

      <% if project.documents.doctype('Introduction').present? %>
        <h5 class="muted"><%= project.documents.doctype('Introduction').title %></h5>
        <p>
          <%= project.documents.doctype('Introduction').abstract ? project.documents.doctype('Introduction').abstract : markdown(project.documents.doctype('Introduction').content) %>
          <%= link_to '... read more', [project.documents.doctype('Introduction').documentable, project.documents.doctype('Introduction')] %>
        </p>
      <% else %>
        <p>No Introduction available</p>
      <% end %>
    </div>
  <% end %>
  <%= render "documents/without_document_type", :var => @group %>
<% end %>

<% content_for :sidebar_section do %>
    <ul class="nav nav-tabs" style="margin-left:20px;">
      <%= content_tag :li, link_to('Overview', "#overview", data: {toggle: 'tab'}), class: 'active' %>
      <%= content_tag :li, link_to('Members', "#members", data: {toggle: 'tab'}) if @group.projects.present? %>
      <%= content_tag :li, link_to('Projects', "#projects", data: {toggle: 'tab'}) if @group.projects.present? %>
    </ul>

    <div class="tab-content" id="sidebar" style="margin-left:20px;">
      <div class="tab-pane active" id="overview">
        <ul class="unstyled">
          <li>Module: <%= link_to @group.cluster.name, @group.cluster %></li>
          <li>Speaker: <%= name_only_or_link_to(@group.speaker) %></li>
          <li>Admin: <%= name_only_or_link_to(@group.group_admin) %></li>

          <small>
            <li style="margin-top:20px;">Creator: <%= name_only_or_link_to(@group.creator) %></li>
            <li>Created on: <%= @group.created_at.strftime('%d. %b %Y (%H:%M)') %></li>
          </small>
        </ul>
      </div>
      <%= content_tag :div, class: 'tab-pane', id: 'members' do %>
        <ul class="unstyled">
          <% for member in @members do %>
            <li><%= name_only_or_link_to(member) %></li>
          <% end %>
        </ul>
      <% end if @group.projects.present? %>
      <%= content_tag :div, class: 'tab-pane', id: 'projects' do %>
        <ul class="unstyled">
          <% for project in @group.projects do %>
            <li><%= link_to "#{project.name}", project %></li>
          <% end %>
        </ul>
      <% end if @group.projects.present? %>
    </div>
<% end %>