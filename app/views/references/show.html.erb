<% title "#{@reference.title}", nil, false %>
<% edit_section_for(@reference, nil) if can? :edit, @reference %>

<% content_for :breadcrumbs_section do %>
  <li><%= link_to 'Root', root_path %> <span class="divider">/</span></li>
  <li><%= link_to 'Bibliography', references_path %> <span class="divider">/</span></li>
  <li class="active"><%= @reference.title %></li>
<% end %>


<% content_for :main_section do %>
  <div class="span8">
    <h3><%= @reference.title %><%= tagging_infos_for(@reference) %></h3>
    <ul class="nav nav-tabs">
      <%= content_tag :li, link_to('Documents', "#docs", data: {toggle: 'tab'}) %>
      <%= content_tag :li, link_to('Uploads', "#uploads", data: {toggle: 'tab'}) %>
      <%= content_tag :li, link_to('Comments', "#comments", data: {toggle: 'tab'}), class: 'active' %>
      <%= content_tag :li, link_to('Connections', "#connections", data: {toggle: 'tab'}) %>
    </ul>
    <div class="tab-content">
      <div class="tab-pane active" id="docs"> 
        <%= content_tag :h3, 'Documents', class: 'muted' if @reference.documents.any? %>
        <%= render "shared/document_docs_without_type", :var => @reference %>
      </div>
      <div class="tab-pane" id="uploads">
        <%= render "shared/buckets_assets", :obj => @reference, :personal => false %>
      </div>
      <div class="tab-pane active" id="comments">
        <%= content_tag :h3, 'Comments', class: 'muted' %>
        <%= render 'comments/list', comments: @reference.comments %>
        <% if @reference.comments.any? %><hr><% end %>
        <%= render 'comments/form', commentable: @reference, size: 'input-xxlarge' %>
      </div>
      <div class="tab-pane" id="connections">
        <p>Dieses Artikel hat einen Bezug zu diesen Objekten</p>
        <p>Au√üerdem in diesem Buch</p>
      </div>
    </div>


  </div>

  <div class="span3 offset1">
    <% if can? :edit, @reference %>
      <div class="btn-group pull-right" style="margin-left:100%;margin-bottom:20px;">
        <a class="btn dropdown-toggle btn-large" data-toggle="dropdown" href="#">
          Add
          <span class="caret"></span>
        </a>
          <ul class="dropdown-menu">
            <li><%= link_to 'Document', polymorphic_path([:new, @reference, :document]) %></li>
            <li><%= link_to 'Bucket', polymorphic_path([:new, @reference, :bucket]) %></li>
          </ul>
      </div>
    <% end  %>

    <h5 class="muted">Title</h5>
    <ul class="unstyled">
      <li><%= @reference.authorships.map{ |a| link_to(a.person.fullname,a.person) }.join(", ").html_safe %></li>
      <li><%= @reference.title %></li>
      <%= content_tag :li, link_to("#{@reference.uri}", "#{@reference.uri}") if @reference.uri.present? %>
    </ul>

    <% if @reference.book %>
      <h5 class="muted">In: <small><%= @reference.book.book_type %></small></h5>
      <p>
        <%= book_edited_by(@reference.book, true, true, true) %>
        <%= @reference.book.year+', ' if @reference.book %>
        <%= book_title(@reference.book, true) %>
        <%= ', '+@reference.first_page if @reference.first_page.present? %> <%= '- '+@reference.last_page if @reference.last_page.present? %>
      </p>

      <% unless @reference.book.unpublished? %>
        <h5 class="muted">Issued</h5>
        <ul class="unstyled">
          <li><%= @reference.book.publisher %></li>
          <li><%= @reference.book.place %></li>
          <%= content_tag :li, 'ISBN'+@reference.book.book_identifier if @reference.book.book_identifier.present? %>
        </ul>
      <% else %>
        <h5 class="muted">UNPUBLISHED</h5>
      <% end %>
    <% end %>

    <h5 class="muted" style="margin-top:50px;">Record Info</h5>
    <ul class="unstyled">
      <li>Created by: <%= @reference.creator.available_name %></li>
      <li>Updated by: <%= @reference.updater.available_name %></li>
    </ul>
  </div>

<% end %>

