<% title "#{@reference.title}", nil %>
<% edit_section_for(@reference, nil) %>

<% content_for :add_section do %>
  <li><%= link_to 'Document', polymorphic_path([:new, @reference, :document]) %></li>
  <li><%= link_to 'Bucket', polymorphic_path([:new, @reference, :bucket]) %></li>
<% end if can? :edit, @reference %>

<% content_for :breadcrumbs_section do %>
  <li><%= link_to 'Root', root_path %> <span class="divider">/</span></li>
  <li><%= link_to 'Bibliography', references_path %> <span class="divider">/</span></li>
  <li class="active"><%= @reference.title %></li>
<% end %>


<% content_for :main_section do %>
    <%= tagging_infos_for(@reference) %>
    <ul class="nav nav-tabs">
      <%= content_tag :li, link_to('Documents', "#docs", data: {toggle: 'tab'}) %>
      <%= content_tag :li, link_to('Uploads', "#uploads", data: {toggle: 'tab'}) %>
      <%= content_tag :li, link_to('Comments', "#comments", data: {toggle: 'tab'}), class: 'active' %>
      <%= content_tag :li, link_to('Connections', "#connections", data: {toggle: 'tab'}) %>
    </ul>
    <div class="tab-content">
      <div class="tab-pane" id="docs"> 
        <%= render "documents/without_document_type", :var => @reference if @reference.documents.any? %>
      </div>
      <div class="tab-pane" id="uploads">
        <%= render "shared/buckets_assets", :obj => @reference, :personal => false %>
      </div>
      <div class="tab-pane active" id="comments">
        <%= content_tag :h3, 'Comments', class: 'muted' %>
        <%= render 'comments/list', comments: @reference.comments %>
        <% if @reference.comments.any? %><hr><% end %>
        <%= render 'comments/form', commentable: @reference, size: 'input-xxlarge' %>
      </div>
      <div class="tab-pane" id="connections">
        <ul class="unstyled">
          <% for item in @reference.items do %>
            <li><%= link_to "#{item.citable.name}", item.citable %></li>
          <% end %>
        </ul>        

        <p>Dieses Artikel hat einen Bezug zu diesen Objekten</p>
        <p>Au√üerdem in diesem Buch</p>

        <p><%= @reference.projects.inspect %> </p>
      </div>
    </div>
<% end %>

<% content_for :sidebar_section do %>
    <h5 class="muted">Title</h5>
    <ul class="unstyled">
      <li><%= @reference.authorships.map{ |a| link_to(a.person_name.name,a.person_name.person) }.join(", ").html_safe %></li>
      <li><%= @reference.title %></li>
      <%= content_tag :li, link_to("#{@reference.uri}", "#{@reference.uri}") if @reference.uri.present? %>
    </ul>

    <% if @reference.book %>
      <h5 class="muted">In: <small><%= @reference.book.book_type %></small></h5>
      <p>
        <%= book_edited_by(@reference.book, true, true, true) %>
        <%= @reference.book.year+', ' if @reference.book %>
        <%= book_title(@reference.book, true) %>
        <%= ', '+@reference.first_page if @reference.first_page.present? %> <%= '- '+@reference.last_page if @reference.last_page.present? %>
      </p>
      <%= content_tag :p, 'Originaly written on: '+@reference.original_date.strftime("%d.%m.%Y") if @reference.original_date %>

      <% unless @reference.book.unpublished? %>
        <h5 class="muted">Issued</h5>
        <ul class="unstyled">
          <li><%= @reference.book.publisher %></li>
          <li><%= @reference.book.place %></li>
          <%= content_tag :li, 'ISBN'+@reference.book.book_identifier if @reference.book.book_identifier.present? %>
        </ul>
      <% else %>
        <h5 class="muted">UNPUBLISHED</h5>
      <% end %>
    <% end %>

    <h5 class="muted" style="margin-top:50px;">Record Info</h5>
    <ul class="unstyled">
      <li>Created by: <%= @reference.creator.available_name %></li>
      <li>Updated by: <%= @reference.updater.available_name %></li>
    </ul>

<% end %>

