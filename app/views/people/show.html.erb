<% title graded_fullname(@person), nil %>
<% edit_section_for(@person, nil) %>

<% content_for :breadcrumbs_section do %>
  <nav class="breadcrumbs">
    <%= link_to "Explore", explore_path %>
    <%= link_to 'People', people_path %>
    <%= link_to "#{graded_fullname(@person)}", @person %>
  </nav>
<% end %>

<% content_for :main_section do %>
  <div class="large-8 columns">
    <%= content_tag :p, (@person.institution.self_and_ancestors.map{ |a| link_to(a.name,a) }.join(", ").html_safe) if @person.institution.present? %>
    <section>
      <h4 class="subheader">General Information, Activities | Curriculum Vitae | Publications</h4>
      <p>Areas, Groups, Projects | Email, Telefon, Fax, Address (durch Institution), Institut</p>
    </section>

    <section>
      <h4 class="subheader">Publications on Babylon</h4>
      <ul>
        <% for reference in @person.references do %>
          <li><%= link_to "#{reference.title}", reference %></li>
        <% end %>
      </ul>
    </section>

    <section>
      <% if @person.user %>
        <h4 class="subheader">Projects</h4>
        <% for membership in @person.user.memberships %>
          <p><%= membership.project.name %></p>
        <% end %>

      <% end %>
    </section>



    <section>
      <h4 class="subheader">Buckets</h4>
      <ul>
        <% for bucket in @buckets do %>
          <li>
            <h4 class="subheader"><%= link_to "#{bucket.name}", [@attachable, bucket] %></h4> 
            <ul class="small-block-grid-2 large-block-grid-4">
            <% for asset in bucket.assets.where('content_type LIKE ?', 'image%').limit(8).order('created_at desc') do %>
                <li><%= link_to (image_tag asset.assetfile.thumb.url), asset, class: "th radius" %></li>
              <% end %>
            </ul>
            <%= bucket.cover_asset_id %>
            <% if can? :edit, @person %>
              <% if (!@person.user_id?) || (@person.user_id == current_user.id) %>
                <%= link_to "Add asset", new_bucket_asset_path(bucket) %>
              <% end %>
            <% end %>
          </li>
        <% end %>
      </ul>
    </section>
  </div>

  <div class="large-3 columns right">
    <% if @buckets.with_profile_pictures.first.cover_asset_id %>
      <%= link_to (image_tag @profile_picture.assetfile.small.url), @profile_picture, class: "th", style: "margin-bottom:30px;" %>
    <% end %>

    <h5 class="subheader">Personal Information</h5>
    <ul class="no-bullet">
      <%= content_tag :li, graded_fullname(@person) + ' (' + @person.nickname + ')' if @person.nickname.present? %>
      <%= content_tag :li, 'System Username: '+@person.user.username if @person.user %>
      <%= content_tag :li, @person.date_of_birth.strftime("%d.%m.%Y") if @person.date_of_birth.present? %>
      <%= content_tag :li, @person.date_of_death.strftime("%d.%m.%Y") if @person.date_of_death.present? %>
      <%= content_tag :li, @person.profession if @person.profession.present? %>
      <%= content_tag :li, @person.gender if @person.gender.present? %>
    </ul>

    <h5 class="subheader">Contact Information</h5>
    <ul class="no-bullet">
      <%= content_tag :li, prepend('mail')+@person.public_email if @person.public_email.present? %>
      <%= content_tag :li, prepend('phone')+@person.phone if @person.phone.present? %>
      <%= content_tag :li, prepend('inbox')+@person.fax if @person.fax.present? %>
      <%= content_tag :div, style: "margin-top:10px;margin-bottom:10px;padding-left:25px;" do %>
        <%= content_tag :li, prepend('address-book', '-25px')+@person.institution.root.self_and_descendants.map{ |a| a.name }.join(", ") %>
        <%= content_tag :li, @person.institution.street %>
        <%= content_tag :li, @person.institution.zip+' '+@person.institution.city %>
        <%= content_tag :li, @person.institution.country %>
      <% end if @person.institution.present? && @person.show_inst_address == true -%>
      <%= content_tag :li, prepend('website')+(link_to "#{@person.uri}", "#{@person.uri}") if @person.uri.present? %>
    </ul>


    <h5 class="subheader" style="margin-top:75px;">Record</h5>
    <ul class="no-bullet">
      <li>Created by: <%= @person.creator.available_name %></li>
      <li>Updated by: <%= @person.updater.available_name %></li>
    </ul>

  </div>
<% end %>