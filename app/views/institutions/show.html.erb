<% title "#{@institution.name}", nil %>
<% edit_section_for(@institution, nil) %>

<% content_for :breadcrumbs_section do %>
  <%= content_tag(:li, link_to("Root", root_path) + content_tag(:span, '/', class: 'divider')) %>
  <%= content_tag(:li, link_to("Institutions", institutions_path) + content_tag(:span, '/', class: 'divider')) %>
  <% for institution in @institution.root.self_and_descendants-@institution.descendants-@institution.siblings do %>
    <%= content_tag :li, institution == @institution ? (institution.name) : (link_to(institution.name, institution) + content_tag(:span, '/', class: 'divider')), class: 'active' %>
  <% end %>
<% end %>

<% content_for :main_section do %>
  <div class="span8">
    <%= content_tag :p, raw('Belongs to: '+(@institution.ancestors.map{ |a| link_to(a.name,a) }.join(", ").html_safe)) unless @institution.root? %></p>

    <%= content_tag :h4, 'Sub-Institutions', class: "muted" if @institution.children.present? %>
    <%= render 'institution_tree', :institution => @institution, :tag => 'p', :indent => 0 %>

    <h4 class="muted">Members</h4>
    <ul class="unstyled">
      <% Person.where('institution_id IN (?)', @institution.self_and_descendants).each do |member| %>
        <li><%= link_to "#{graded_fullname(member)}", member %></li>
      <% end %>
    </ul>

  </div>

  <div class="vcard span3 offset1">
    <% if can? :edit, @institution %>
      <div class="btn-group pull-right" style="margin-left:100%;margin-bottom:20px;">
        <a class="btn dropdown-toggle btn-large" data-toggle="dropdown" href="#">
          Add
          <span class="caret"></span>
        </a>
          <ul class="dropdown-menu">
            <li><%= link_to 'Sub-Institution', new_institution_path(:parent_id => @institution) %></li>
          </ul>
      </div>
    <% end  %>
    <%= link_to (image_tag('microformat-logo-small.png', class: "pull-right")), page_path('help', anchor: 'microformats') %>
    <h4 class="muted">Contact Info</h4>
    <ul class="unstyled">
      <address>
        <%= content_tag :li, (@institution.root.self_and_descendants-@institution.descendants-@institution.siblings).map{ |a| a.name }.join(", "), class: "org" %>
        <%= content_tag :li, @institution.name, class: "fn hide" %>
        <%= content_tag :li, (content_tag :abbr, (content_tag :span, @institution.phone, class: "value"), class: 'type', title: 'Office'), class: "tel" if @institution.phone.present? %>
        <%= content_tag :li, (content_tag :abbr, (content_tag :span, @institution.fax, class: "value"), class: 'type', title: 'Fax'), class: "tel" if @institution.fax.present? %>
        <%= content_tag :div, class: "adr", style: "margin-top:10px;margin-bottom:10px;" do %>
          <%= content_tag :li, @institution.street, class: "street-address" %>
          <%= content_tag :li, (content_tag :span, @institution.zip, class: "postal-code")+' '+(content_tag :span, @institution.city, class: "locality") %>
          <%= content_tag :li, @institution.country, class: "country-name" %>
        <% end %>
        <%= content_tag :li, link_to("#{@institution.uri}", "#{@institution.uri}"), class: "url" if @institution.uri.present? %>
      </address>
    </ul> 

    <h4 class="muted" style="margin-top:50px;">Record Info</h4>
    <ul class="unstyled">
      <li>Created by: <%= @institution.creator.available_name %></li>
      <li>Updated by: <%= @institution.updater.available_name %></li>
    </ul>
  </div>
  
<% end %>