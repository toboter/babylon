<% title @item.inventory_name, nil, nil %>
<% edit_section_for(@item, nil) %>
<% publishing_section_for(@item) %>
<% footer_section(@item) %>


<% content_for :breadcrumbs_section do %>
  <li><%= link_to 'Root', root_path %> <span class="divider">/</span></li>
  <li><%= link_to 'Items', items_path %> <span class="divider">/</span></li>
  <li class="active"><%= "#{@item.inventory_name}" %></li>
<% end %>

<% content_for :main_section do %>
  <div class="span12">
    <%= content_tag :h3, class: "muted" do %>
      <%= @item.title? ? @item.title : @item.inventory_name %>
      <%= yield(:edit_section) %>
    <% end %>
    <div class="row-fluid">
      <div class="span4">
        <%= content_tag :div, id: @item.buckets.first.id.to_s+"-album-carousel", class: "carousel slide", :"data-interval" => false do %>
          <ol class="carousel-indicators">
            <% for asset in @item.buckets.first.assets do %>
              <li data-target="#<%= @item.buckets.first.id %>-album-carousel" data-slide-to="<%= asset.id %>" class="<%= 'active' if asset == @item.buckets.first.cover %>"></li>
            <% end %>
          </ol>
          <!-- Carousel items -->
          <div class="carousel-inner">
            <% for asset in @item.buckets.first.assets do %>
              <div class="item <%= 'active' if asset == @item.buckets.first.cover %>">
                <div class="crop"><%= image_tag asset.assetfile.large.url %></div>
                <div class="carousel-caption">
                  <h4><%= asset.name %></h4>
                  <p><%= asset.author.name + ' ' + asset.license %></p>
                </div>
              </div>
            <% end %>
          </div>
          <!-- Carousel nav -->
          <a class="carousel-control left" href="#<%= @item.buckets.first.id %>-album-carousel" data-slide="prev">&lsaquo;</a>
          <a class="carousel-control right" href="#<%= @item.buckets.first.id %>-album-carousel" data-slide="next">&rsaquo;</a>
        <% end if @item.buckets.first && @item.buckets.first.assets.any? %>
      </div>
  
      <div class="span8">
        <div class="row-fluid">
          <div class="span6">
            <div class="info_section">
              <table class="table table-bordered table-hover">
                <%= item_description('Inventory Number', @item.inventory_name) %>
                <%= item_description('Context', @item.context_id) %>
                <%= item_description('Classification', @item.classification.name) if @item.classification %>
              </table> 
              <%= content_tag :span, tagging_infos_for(@item), class: 'pull-right' %>
              <%= markdown(@item.description) if @item.description.present? %> 
            </div>
          </div>
          <div class="span6">
            <%= link_to 'Publication status','', class: 'btn btn-block', style: 'margin-bottom:5px;' %>
            <%= content_tag :div, class: "item-options well" do %>
              <%= content_tag :div, class: "" do %>
                <%= link_to add_studyassignment_path(item_id: @item.id, project_id: current_aspect.id), :method => :post, class: 'btn btn-block btn-success' do %>
                  <%= content_tag :i, '', class: 'icon-plus icon-white' %>
                  <%= current_aspect.name %>
                <% end %>
              <% end if !current_aspect.items.include?(@item) %>
              <%= content_tag :div, class: "" do %>
                <%= link_to destroy_studyassignment_path(item_id: @item.id, project_id: current_aspect.id), :method => :delete, class: 'btn btn-block btn-warning' do %>
                  <%= content_tag :i, '', class: 'icon-trash icon-white' %>
                  <%= current_aspect.name %>
                <% end %>
              <% end if current_aspect.items.include?(@item) %>
            <% end if aspect? %>
            <div class="issues-options well well-small">
              <i class="icon-exclamation-sign"></i>
              <%= link_to 'Issues', item_issues_path(@item) %> 
              <%= content_tag :span, @item.issues.count, class: 'badge pull-right' %>
            </div>
            <div class="item-options">
              <ul class="nav nav-pills nav-stacked">
                <%= content_tag :li do %>
                  <%= link_to [@item, :documents] do %>
                    Documents
                    <span class="badge pull-right"><%= @item.documents.without_document_type.count %></span>
                  <% end %>
                <% end %>
                <%= content_tag :li do %>
                  <%= link_to [@item, :references] do %>
                    Bibliography/References
                    <span class="badge pull-right"><%= @item.references.count %></span>
                  <% end %>
                <% end %>
                <%= content_tag :li do %>
                  <%= link_to [@item, :buckets] do %>
                    Buckets
                    <span class="badge pull-right"><%= @item.buckets.count %></span>
                  <% end %>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>
  
    <div class="row-fluid">
      <div class="span4">
        History
        <div class="accordion-inner">
          <%= item_description('Accession Date', @item.accession_date) %><br />
          <% for action in @item.actions do %>
            <p><%= action.inspect %></p>
          <% end %>
        </div>

        Buckets
        <div class="accordion-inner">
          <% for bucket in @item.buckets do %>
            <li><%= link_to "#{bucket.full_bucket_name}", [bucket.attachable, bucket] %></li>
          <% end if @item.buckets.any? %>
        </div>
      </div>

      <div class="span8">
        Project Workspace Info
        <div class="accordion-inner">
          <% for studyassignment in @item.studyassignments do %>
            <li><%= name_only_or_link_to(studyassignment.creator) %> in <%= link_to "#{studyassignment.project.name}", [studyassignment.project.projectable, studyassignment.project] %></li>
          <% end if @item.studyassignments.any? %>
        </div>

        Documents
        <div class="accordion-inner">
          <%= render @item.documents %>
        </div>

        References
        <div class="accordion-inner">
          <%= render "reference_entries", :citations => @item.citations %>
        </div>
      </div>
    </div>
  </div>
<% end %>