<%= form_for @item, :html => {:class => "form-horizontal"} do |f| %>
  <%= f.error_messages %>


  <div class="row-fluid">
    <div class="span12">

<ul class="nav nav-tabs">
  <li class="active"><a href="#metainfo" data-toggle="tab">General</a></li>
  <li><a href="#classification" data-toggle="tab">Classification</a></li>
  <li><a href="#actions" data-toggle="tab">Sources</a></li>
  <li><a href="#publications" data-toggle="tab">Publications</a></li>
  <li><a href="#connections" data-toggle="tab">Connected objects</a></li>
</ul>

<div class="tab-content">
<div class="tab-pane active" id="metainfo">
  <div class="control-group">
    <%= f.label 'Collection', class: 'control-label' %>
    <div class="controls">
      <%= f.collection_select :collection_id, Collection.all, :id, :shortcut, {include_blank: false}, {disabled: !can?(:update, Collection)} %>
    </div>
  </div>

  <%= content_tag :div, class: "control-group" do %>
    <%= f.label 'Photo', class: 'control-label' %>
    <div class="controls">
      <%= f.collection_select :cover_asset_id, @item.assets.where('content_type LIKE ?', '%image%' ), :id, :name, {include_blank: false} %>
    </div>
  <% end unless @item.new_record? %>

  <div class="control-group">
    <%= f.label :inventory_number, class: 'control-label' %>
    <div class="controls form-inline">
      <%= f.text_field :inventory_number, placeholder: 'Inventory number' %>
      <%= f.text_field :inventory_number_index, placeholder: 'Index (optional)', style: 'margin-left:10px;' %>
    </div>
  </div>

  <div class="control-group">
    <%= f.label :excavation_id, 'Excavation number', class: 'control-label' %>
    <div class="controls">
      <%= f.text_field :excavation_id, placeholder: 'excavation number', class: 'span6' %>
    </div>
  </div>

  <div class="control-group">
    <%= f.label '', 'other Ids', class: 'control-label' %>
    <div class="controls form-inline">
      <%= f.text_field :dissov_id, placeholder: 'Dissov Id' %>
      <%= f.text_field :mds_id, placeholder: 'MDS Id', style: 'margin-left:10px;' %>
    </div>
  </div>

  <div class="control-group">
    <%= f.label :title, class: 'control-label' %>
    <div class="controls">
      <%= f.text_field :title, placeholder: 'descrptive title', class: 'span6' %>
    </div>
  </div>

  <div id="description">

    <div class="control-group">
      <%= f.label :description, class: 'control-label' %>
      <div class="controls">
        <%= f.text_area :description, rows: 10, class: 'input-block-level' %>
        <p>Use Markdown for formatting. <a href="#" data-toggle="collapse" data-target="#md-info">See examples.</a></p>
        <div class="collapse" id="md-info">
          <%= render 'shared/md-info' %>
        </div>
      </div>
    </div>


  </div>


  <div id="props">
    <%= content_tag :h4, 'Collection specific attributes', class: 'controls' %>
    <%= f.fields_for :properties, OpenStruct.new(@item.properties) do |builder| %>
      <% @item.collection.fields.order('name ASC').each do |field| %>
        <%= render "items/fields/#{field.field_type}", field: field, f: builder %>
      <% end %>
    <% end if params[:collection_id].present? || @item.collection %>
  </div>
</div>

<div class="tab-pane" id="classification">
  <div class="control-group">
    <%= f.label :classification_id, class: 'control-label' %>
    <div class="controls">
      <%= f.collection_select(:classification_id, ItemClassification.arrange_as_tree({:order => 'name'}), :id, :name_for_selects, {}, {class: 'form-control chosen-select'}) %>
      <p class="help-block"><%= link_to 'Edit classifications', item_classifications_path, target: 'blank' %></p>
    </div>
  </div>

  <div class="control-group">
    <%= f.label :tag_ids, "Tags", class: 'control-label' %>
    <div class="controls">
      <%= f.collection_select :tag_ids, Tag.arrange_as_tree({:order => 'name'}), :id, :name_for_selects, {}, {multiple: true, class: 'form-control chosen-select input-block-level'} %>
      <p class="help-block"><%= link_to 'Edit tags', tags_path, target: 'blank' %></p>
    </div>
  </div>
</div>

<div class="tab-pane" class="" id='actions'>
  <%= f.fields_for :actions do |builder| %>
    <%= render "action_fields", :f => builder %>
  <% end %>
  <div class="links controls">
    <%= link_to_add_association "Add Action", f, :actions %>
  </div>
</div>

<div class="tab-pane" id="publications">
  <%= f.fields_for :citations do |builder| %>
    <%= render "citation_fields", :f => builder %>
  <% end %>
  <div class="links controls">
    <%= link_to_add_association "Add publication", f, :citations %>
  </div>
</div>
  

<div class="tab-pane" id='connections'>
  <%= f.fields_for :connections do |builder| %>
    <%= render "connection_fields", :f => builder %>
  <% end %>
  <div class="links controls">
    <%= link_to_add_association "Add Connection", f, :connections %>
  </div>
</div>




  <div class="form-actions" style="">
    <%= f.submit "Speichern", :class => 'btn btn-primary' %>
  </div>
</div>
</div>
</div>

  <% content_for :edit_section do %>
    <div class="pull-right">
      <%= link_to 'Abbrechen', :back, :class => 'btn' %>
    </div>
  <% end %>    
<% end %>
